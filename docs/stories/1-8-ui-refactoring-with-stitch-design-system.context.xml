<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>8</storyId>
    <title>UI Refactoring with Stitch Design System</title>
    <status>drafted</status>
    <generatedAt>2025-11-06</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/1-8-ui-refactoring-with-stitch-design-system.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>a user</asA>
    <iWant>a professional, polished interface that matches modern design standards</iWant>
    <soThat>the application looks credible and is enjoyable to use</soThat>
    <tasks>
- Task 1: Configure Tailwind CSS and design system dependencies (AC: #2, #3)
  - Install Tailwind CSS, PostCSS, Autoprefixer
  - Initialize and configure Tailwind with Stitch colors
  - Add Google Fonts Inter and Material Symbols Outlined
  - Verify configuration

- Task 2: Remove Vue 3 template example elements (AC: #1)
  - Delete HelloWorld.vue, TheWelcome.vue, WelcomeItem.vue
  - Delete icons/ directory and logo.svg
  - Update imports and verify no broken references

- Task 3: Redesign UploadView.vue with Stitch design (AC: #4, #8)
  - Apply dark theme with glass-morphism card
  - Preserve FileUpload functionality
  - Maintain API call logic

- Task 4: Redesign ProgressView.vue with Stitch design (AC: #5, #8)
  - Add top navigation with back button
  - Style progress bar and stage messages
  - Preserve polling and navigation logic

- Task 5: Redesign ResultsView.vue with media player placeholder (AC: #6, #8)
  - Add top navigation bar
  - Create media player placeholder area
  - Redesign SubtitleList with card styling

- Task 6: Create ExportModal.vue component (AC: #7)
  - Implement modal overlay with export format options
  - Add keyboard and click-outside support
  - Placeholder for Epic 2 functionality

- Task 7: Update global styles and layout (AC: #2, #9)
  - Apply dark theme to App.vue
  - Test responsive breakpoints

- Task 8: Regression testing and validation (AC: #8, #10)
  - Run test suite, TypeScript checks, linter
  - End-to-end workflow testing
    </tasks>
  </story>

  <acceptanceCriteria>
1. All Vue 3 template example elements removed (Vue logo, HelloWorld.vue, TheWelcome.vue, WelcomeItem.vue)
2. Tailwind CSS configured with Stitch design system (primary: #137fec, dark bg: #101922)
3. Google Fonts Inter and Material Symbols Outlined integrated
4. UploadView.vue redesigned with dark theme, glass-morphism card, centered layout
5. ProgressView.vue redesigned with top nav bar, audio wave animation, professional progress indicators
6. ResultsView.vue redesigned with media player placeholder, styled subtitle cards
7. ExportModal.vue component created (UI only, functionality in Epic 2)
8. All Epic 1 functionality verified working (upload, progress, transcription display)
9. Responsive design works on desktop, tablet, and mobile
10. No TypeScript errors, no console errors, code properly formatted
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/architecture.md</path>
        <title>Decision Architecture - KlipNote</title>
        <section>Component Structure Pattern (Lines 1506-1563)</section>
        <snippet>Standard Vue SFC structure with Composition API: script setup, props/emits, store references, local state, computed properties, methods, lifecycle hooks. TypeScript required with explicit types.</snippet>
      </doc>

      <doc>
        <path>docs/architecture.md</path>
        <title>Decision Architecture - KlipNote</title>
        <section>Testing Strategy (Lines 797-1063)</section>
        <snippet>Vitest + Vue Testing Library for component tests. Coverage target: 70%+. Test organization in frontend/src/__tests/. Mock API calls with MSW. Update existing tests for UI changes.</snippet>
      </doc>

      <doc>
        <path>docs/epics.md</path>
        <title>Epic 1: Foundation & Core Transcription Workflow</title>
        <section>Story 1.8 Context</section>
        <snippet>Epic 1 delivers complete upload → transcription → display workflow. Story 1.8 is final refactoring story to polish UI before Epic 2. All functionality from Stories 1.1-1.7 must continue working.</snippet>
      </doc>

      <doc>
        <path>docs/stories/1-7-frontend-transcription-display.md</path>
        <title>Story 1.7: Frontend Transcription Display</title>
        <section>Infrastructure Built</section>
        <snippet>Vue 3 + Vite + TypeScript operational on port 5173. Pinia store manages transcription state. API client in services/api.ts. Three routes configured. SubtitleList component renders segments. 129 tests passing with 66.98% coverage.</snippet>
      </doc>

      <doc>
        <path>temp/08_story-1-8-recommendation.md</path>
        <title>UI Refactoring Requirements</title>
        <section>Stitch Design System Specifications</section>
        <snippet>Apply Stitch design: Primary color #137fec, dark background #101922. Use Tailwind CSS, Inter font, Material Symbols icons. Remove all Vue template elements. Redesign 3 views with glass-morphism and card layouts.</snippet>
      </doc>

      <doc>
        <path>temp/klipnote-ui/stitch-design/1/code.html</path>
        <title>UploadView Design Reference</title>
        <section>Complete HTML/CSS Implementation</section>
        <snippet>Full-screen dark theme layout with centered glass-morphism card. Large blue circular upload button. Drag-and-drop support. Responsive design with mobile-first approach.</snippet>
      </doc>

      <doc>
        <path>temp/klipnote-ui/stitch-design/2/code.html</path>
        <title>ProgressView Design Reference</title>
        <section>Complete HTML/CSS Implementation</section>
        <snippet>Top navigation with back button. Audio wave animation. Styled progress bar with blue gradient. Stage message display. Bottom "Go to Editor" button.</snippet>
      </doc>

      <doc>
        <path>temp/klipnote-ui/stitch-design/3/code.html</path>
        <title>ResultsView Design Reference</title>
        <section>Complete HTML/CSS Implementation</section>
        <snippet>Top navigation bar with menu. Media player placeholder (16:9 aspect ratio). Subtitle cards with styled timestamps. Scrollable layout. Bottom export button.</snippet>
      </doc>

      <doc>
        <path>temp/klipnote-ui/stitch-design/4/code.html</path>
        <title>ExportModal Design Reference</title>
        <section>Complete HTML/CSS Implementation</section>
        <snippet>Modal overlay with centered dialog. Export format radio buttons (TXT/SRT). Glass-morphism styling. ESC and click-outside-to-close support.</snippet>
      </doc>
    </docs>

    <code>
      <artifact>
        <path>frontend/src/stores/transcription.ts</path>
        <kind>store</kind>
        <symbol>useTranscriptionStore</symbol>
        <lines>1-57</lines>
        <reason>Pinia store managing transcription state (jobId, status, progress, segments). All API interactions go through this store. Must preserve existing actions: fetchStatus(), fetchResult(), reset().</reason>
      </artifact>

      <artifact>
        <path>frontend/src/services/api.ts</path>
        <kind>service</kind>
        <symbol>uploadFile, fetchStatus, fetchResult</symbol>
        <lines>1-83</lines>
        <reason>API client with native fetch(). All backend communication functions. Must preserve existing function signatures and error handling patterns.</reason>
      </artifact>

      <artifact>
        <path>frontend/src/views/UploadView.vue</path>
        <kind>view</kind>
        <symbol>UploadView</symbol>
        <lines>1-50</lines>
        <reason>Upload page component. Contains FileUpload integration and uploadFile() API call logic. Redesign template only - preserve script logic.</reason>
      </artifact>

      <artifact>
        <path>frontend/src/views/ProgressView.vue</path>
        <kind>view</kind>
        <symbol>ProgressView</symbol>
        <lines>N/A</lines>
        <reason>Progress monitoring page. Contains polling logic (fetchStatus every 3 seconds) and auto-navigation on completion. Redesign template only - preserve script logic.</reason>
      </artifact>

      <artifact>
        <path>frontend/src/views/ResultsView.vue</path>
        <kind>view</kind>
        <symbol>ResultsView</symbol>
        <lines>N/A</lines>
        <reason>Results display page. Uses SubtitleList component, fetchResult() on mount. Redesign template with media player placeholder - preserve script logic.</reason>
      </artifact>

      <artifact>
        <path>frontend/src/components/SubtitleList.vue</path>
        <kind>component</kind>
        <symbol>SubtitleList</symbol>
        <lines>1-50</lines>
        <reason>Subtitle segment rendering component. Uses formatTime() utility. Redesign styling with Stitch card design - keep props interface: segments: Segment[].</reason>
      </artifact>

      <artifact>
        <path>frontend/src/components/HelloWorld.vue</path>
        <kind>component</kind>
        <symbol>HelloWorld</symbol>
        <lines>N/A</lines>
        <reason>Vue template example component. DELETE per AC#1.</reason>
      </artifact>

      <artifact>
        <path>frontend/src/components/TheWelcome.vue</path>
        <kind>component</kind>
        <symbol>TheWelcome</symbol>
        <lines>N/A</lines>
        <reason>Vue template example component. DELETE per AC#1.</reason>
      </artifact>

      <artifact>
        <path>frontend/src/components/WelcomeItem.vue</path>
        <kind>component</kind>
        <symbol>WelcomeItem</symbol>
        <lines>N/A</lines>
        <reason>Vue template example component. DELETE per AC#1.</reason>
      </artifact>

      <artifact>
        <path>frontend/src/utils/formatters.ts</path>
        <kind>utility</kind>
        <symbol>formatTime</symbol>
        <lines>N/A</lines>
        <reason>Timestamp formatting utility (seconds to MM:SS). Used by SubtitleList. Do not modify.</reason>
      </artifact>
    </code>

    <dependencies>
      <frontend>
        <runtime>
          <package name="vue" version="^3.5.22">Core Vue 3 framework with Composition API</package>
          <package name="vue-router" version="^4.6.3">Client-side routing for /upload, /progress/:jobId, /results/:jobId</package>
          <package name="pinia" version="^3.0.3">State management for transcription store</package>
        </runtime>

        <development>
          <package name="vite" version="^7.1.11">Build tool with HMR, port 5173</package>
          <package name="typescript" version="~5.9.0">Type safety and type checking</package>
          <package name="vitest" version="^3.2.4">Unit testing framework</package>
          <package name="@vue/test-utils" version="^2.4.6">Vue component testing utilities</package>
          <package name="@vitest/coverage-v8" version="^3.2.4">Code coverage reporting</package>
          <package name="vue-tsc" version="^3.1.1">TypeScript type checking for Vue</package>
          <package name="@vitejs/plugin-vue" version="^6.0.1">Vite plugin for Vue SFC support</package>
        </development>

        <toInstall>
          <package name="tailwindcss" version="latest">Utility-first CSS framework for Stitch design system</package>
          <package name="postcss" version="latest">CSS processor required by Tailwind</package>
          <package name="autoprefixer" version="latest">PostCSS plugin for vendor prefixing</package>
          <package name="@tailwindcss/forms" version="latest">Tailwind plugin for better form styling</package>
        </toInstall>

        <externalAssets>
          <asset name="Google Fonts Inter" url="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap">Primary typography font</asset>
          <asset name="Material Symbols Outlined" url="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0">Icon library for UI elements</asset>
        </externalAssets>
      </frontend>
    </dependencies>
  </artifacts>

  <constraints>
- DO NOT modify functionality - only update visual design and styling
- PRESERVE all API calls in UploadView, ProgressView, ResultsView
- PRESERVE Pinia store integration - keep all store references intact
- MAINTAIN test suite - all 129 existing tests must continue passing (update assertions if UI structure changes)
- DO NOT modify: transcription.ts store, api.ts client, types/api.ts interfaces, utils/formatters.ts
- Files to DELETE: HelloWorld.vue, TheWelcome.vue, WelcomeItem.vue, icons/ directory, assets/logo.svg
- Files to REFACTOR (template only): UploadView.vue, ProgressView.vue, ResultsView.vue, SubtitleList.vue
- Files to CREATE: tailwind.config.js, postcss.config.js, ExportModal.vue
- Files to MODIFY: App.vue (dark theme), assets/main.css (Tailwind directives), index.html (Google Fonts)
- Component structure pattern: Vue 3 Composition API with script setup lang="ts"
- TypeScript required: All props, emits, refs must have explicit types
- Error handling: Preserve existing try/catch patterns and error message display
- Routing: Do not modify router configuration - preserve /upload, /progress/:jobId, /results/:jobId
- Responsive design: Mobile-first approach with breakpoints at 768px (tablet), 1024px (desktop)
- Testing requirement: Run npm run test:unit, npm run type-check, npm run lint, npm run build before completion
- No backend changes in this story - frontend-only refactoring
  </constraints>

  <interfaces>
    <interface>
      <name>uploadFile</name>
      <kind>API function</kind>
      <signature>async function uploadFile(file: File): Promise&lt;UploadResponse&gt;</signature>
      <path>frontend/src/services/api.ts</path>
    </interface>

    <interface>
      <name>fetchStatus</name>
      <kind>API function</kind>
      <signature>async function fetchStatus(jobId: string): Promise&lt;StatusResponse&gt;</signature>
      <path>frontend/src/services/api.ts</path>
    </interface>

    <interface>
      <name>fetchResult</name>
      <kind>API function</kind>
      <signature>async function fetchResult(jobId: string): Promise&lt;TranscriptionResult&gt;</signature>
      <path>frontend/src/services/api.ts</path>
    </interface>

    <interface>
      <name>SubtitleList Props</name>
      <kind>Component interface</kind>
      <signature>defineProps&lt;{ segments: Segment[] }&gt;()</signature>
      <path>frontend/src/components/SubtitleList.vue</path>
    </interface>

    <interface>
      <name>Segment</name>
      <kind>TypeScript interface</kind>
      <signature>interface Segment { start: number; end: number; text: string }</signature>
      <path>frontend/src/types/api.ts</path>
    </interface>

    <interface>
      <name>StatusResponse</name>
      <kind>TypeScript interface</kind>
      <signature>interface StatusResponse { status: 'pending' | 'processing' | 'completed' | 'failed'; progress: number; message: string; created_at: string; updated_at: string }</signature>
      <path>frontend/src/types/api.ts</path>
    </interface>
  </interfaces>

  <tests>
    <standards>Framework: Vitest + @vue/test-utils in jsdom environment. Coverage: 66.98% (maintain 60%+ target). Testing pattern: Component mounting with mount(), event assertions with wrapper.emitted(), DOM queries with .find()/.findAll(). All 129 existing tests must pass after UI refactoring. Update test assertions if CSS classes or DOM structure changes, but preserve test logic. Mock strategy: No API mocks needed for component tests (components tested in isolation).</standards>

    <locations>frontend/src/__tests__/*.test.ts - Component and view tests
frontend/src/__tests__/components/*.test.ts - Component-specific tests
frontend/src/__tests__/views/*.test.ts - View-specific tests
frontend/src/__tests__/utils/*.test.ts - Utility function tests
frontend/vitest.config.ts - Vitest configuration</locations>

    <ideas>
      <idea ac="1,2,3">
- Test: Verify template components deleted (HelloWorld.vue, TheWelcome.vue, WelcomeItem.vue not importable)
- Test: Verify Tailwind CSS classes render correctly (dark-bg, primary colors)
- Test: Verify Google Fonts Inter and Material Symbols load in document head
- Scope: Project structure validation
      </idea>

      <idea ac="4">
- Test: UploadView renders with Tailwind classes (min-h-screen, bg-dark-bg)
- Test: Upload button has Material Symbol icon (upload_file)
- Test: Glass-morphism card applies backdrop-blur class
- Test: FileUpload component integration still works (file-selected event)
- Test: uploadFile() API call still triggered on button click
- Test: Navigation to /progress/:jobId still occurs after upload
- Scope: UploadView component tests - update CSS class assertions
      </idea>

      <idea ac="5">
- Test: ProgressView renders top navigation with back button
- Test: Progress bar displays with Tailwind styled classes
- Test: Stage message displays correctly (from store.message)
- Test: Polling logic still works (fetchStatus called every 3 seconds)
- Test: Auto-navigation to /results/:jobId on status === 'completed'
- Test: Error state renders with retry button
- Scope: ProgressView component tests - update CSS class assertions
      </idea>

      <idea ac="6">
- Test: ResultsView renders top navigation bar
- Test: Media player placeholder section exists with "Coming in Epic 2" text
- Test: SubtitleList component still renders segments correctly
- Test: fetchResult() called on mount
- Test: Subtitle cards have Tailwind card styling (rounded-xl, shadow)
- Test: Timestamp styling uses monospace font and primary color
- Scope: ResultsView and SubtitleList component tests - update CSS class assertions
      </idea>

      <idea ac="7">
- Test: ExportModal component renders modal overlay
- Test: Export format options render (TXT, SRT radio buttons)
- Test: Cancel button closes modal (emits 'close' event)
- Test: ESC key closes modal (keyboard event handler)
- Test: Click outside modal closes it (overlay click handler)
- Test: Modal styling uses glass-morphism and Stitch colors
- Scope: NEW ExportModal.test.ts file
      </idea>

      <idea ac="8,9">
- Test: All 129 existing tests pass after refactoring
- Test: Responsive classes applied (sm:, md:, lg: breakpoints)
- Test: Mobile viewport (320px) renders correctly
- Test: Desktop viewport (1024px) renders correctly
- Scope: Regression testing across all components
      </idea>

      <idea ac="10">
- Test: npm run type-check passes (no TypeScript errors)
- Test: npm run lint passes (no ESLint errors)
- Test: npm run build succeeds (production build)
- Test: No console errors in test output
- Scope: Build validation and code quality
      </idea>
    </ideas>
  </tests>
</story-context>
