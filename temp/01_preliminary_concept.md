### **产品需求文档 (PRD): Web 转录与校对工具**

| **文档版本** | 1.0 |
| :--- | :--- |
| **创建日期** | 2025年11月2日 |
| **产品负责人** | (您的名字) |
| **状态** | 草案 |

-----

### 1\. 产品愿景与目标

#### 1.1 产品愿景

打造一个高性能、可自托管的 Web 音视频转录服务。它将借鉴专业桌面软件（如 Subtitle Edit）的核心交互体验，但提供一个极其简洁、易于上手的 Web 界面，让用户（如朋友、同事）可以轻松地对媒体文件进行转录、校对和编辑。

#### 1.2 解决的问题

1.  **易用性与部署：** 专业的桌面转录工具（如 Subtitle Edit）功能强大但 UI 复杂，且需要本地安装。本项目将其 Web 化，用户（朋友/同事）无需安装，打开网页即可使用。
2.  **资源利用：** 利用项目所有者（您）的本地 GPU 资源提供高性能转录服务，替代昂贵或有隐私顾虑的云服务。
3.  **校对效率：** 传统转录（纯文本）与媒体文件是分离的。本工具提供“点击字幕跳转播放”和“高亮当前字幕”的核心功能，极大提升校对和编辑效率。

#### 1.3 目标用户

  * **服务提供者 (Host)：** 您本人。负责在自己的 GPU 服务器上部署和维护此服务。
  * **终端用户 (User)：** 您的朋友、同事或其他受信任的用户。他们需要转录音视频内容（如会议记录、访谈、课程视频），并希望有一个简单工具快速校对和修正结果。

-----

### 2\. 核心功能 (V1.0)

我们将 V1.0 的功能严格限制在“转录-校对-导出”的核心闭环上，保持 UI 的绝对简洁。

#### F-01: 媒体上传

  * **用户故事：** 作为一个终端用户，我希望能方便地上传一个音频或视频文件，以便系统进行转录。
  * **需求：**
    1.  前端页面提供一个清晰的“上传”区域（如拖拽框或文件选择按钮）。
    2.  必须支持常见的**视频格式**（如 `.mp4`, `.mkv`, `.mov`, `.webm`）。
    3.  必须支持常见的**音频格式**（如 `.mp3`, `.m4a`, `.aac`, `.wav`）。
    4.  上传过程中应显示清晰的进度条。

#### F-02: 实时转录与反馈

  * **用户故事：** 作为一个终端用户，我希望在文件上传后，能立即看到转录任务的进度和逐句生成的结果，而不是长时间的“处理中”等待。
  * **需求：**
    1.  文件上传完成后，前端自动连接 WebSocket，后端立即开始执行转录。
    2.  **后端（引擎）：** 必须使用用户提供的 `streaming_whisperx_provider` 脚本作为转录核心，以保证高性能。
    3.  **实时进度：** 前端应能接收并显示后端的 `progress` 消息（例如：“正在执行 VAD...”, “正在转录 2/10 区块...”）。
    4.  **实时分段：** 后端每生成一个 `segment`（包含 `start`, `end`, `text`），必须立即通过 WebSocket 推送给前端。
    5.  前端在收到 `segment` 后，动态将其添加到字幕列表中，页面无需刷新。

#### F-03: 媒体播放器

  * **用户故事：** 作为一个终端用户，我需要一个媒体播放器来播放我上传的文件，以便我核对转录内容。
  * **需求：**
    1.  转录开始后（或上传完成后），媒体文件应自动加载到播放器中。
    2.  播放器 UI 必须简洁（推荐使用 [Plyr.io](https://plyr.io/) 或原生 HTML5 标签）。
    3.  如果上传的是视频，播放器显示视频画面；如果上传的是音频，播放器只显示音频控制条。
    4.  提供基础控制：播放/暂停、进度条拖动、音量控制。

#### F-04: 播放器-字幕双向同步 (核心交互)

  * **用户故事 (1)：** 当我阅读字幕列表，发现一句可疑的文本时，我希望能**点击该句字幕**，播放器就**自动跳转**到那个时间点开始播放，方便我立刻核实。
  * **用户故事 (2)：** 当我从头播放媒体时，我希望字幕列表能**自动高亮**当前正在播放的句子，方便我跟读和校对。
  * **需求：**
    1.  **(点击跳转)** 字幕列表中的每一项都必须是可点击的。点击后，JavaScript 获取该项的 `start` 时间戳，并设置播放器的 `currentTime` 为该值。
    2.  **(播放高亮)** 必须监听播放器的 `timeupdate` 事件。根据 `currentTime`，实时计算当前对应的字幕项，并为其添加一个醒目的 CSS 高亮样式（例如不同的背景色）。

#### F-05: 转录内容二次编辑

  * **用户故事：** 作为一个终端用户，当我发现转录的文本有错字，或者时间戳不准时，我希望能**直接在网页上修改**它们。
  * **需求：**
    1.  **文本编辑：** 字幕列表中的每一句 `text` 都必须是可编辑的（例如，使用 `<input type="text">` 或 `contenteditable="true"` 属性）。
    2.  **时间编辑：** 每一句的 `start` 和 `end` 时间戳也必须是可编辑的。
    3.  所有编辑都只发生在前端（浏览器）中，实时更新前端的数据状态。

#### F-06: 结果导出

  * **用户故事：** 当我完成所有的校对和编辑后，我希望能下载一个包含我修改的最终版文件。
  * **需求：**
    1.  页面提供一个“导出”按钮。
    2.  点击后，前端将\*\*当前（已编辑）\*\*的字幕数据列表（JSON 格式）`POST` 到后端。
    3.  后端提供一个 `/export` 接口，接收此 JSON 数据。
    4.  后端负责将 JSON 格式化为标准文件。
    5.  V1.0 必须支持至少两种导出格式：
          * `*.txt` (纯文本)
          * `*.srt` (SubRip 字幕文件)
    6.  后端将生成的字幕文件作为“文件下载”响应返回给用户。

-----

### 3\. 非功能性需求

| 类别 | 需求 |
| :--- | :--- |
| **UI / UX** | 1. **极简主义：** V1.0 界面只包含核心组件（上传区、播放器、字幕列表、导出按钮）。<br> 2. **单一视图：** 所有功能都集中在同一个页面，无需跳转。<br> 3. **响应式：** 界面应能适配不同宽度的桌面浏览器。 |
| **性能** | 1. **转录：** 性能瓶颈只应在后端的 GPU 算力。<br> 2. **前端：** UI 必须始终保持流畅，即使在转录过程中或加载长字幕列表时也不得卡顿。<br> 3. **通信：** 必须使用 WebSocket 进行实时通信，避免前端轮询。 |
| **部署** | 1. **自托管：** 整个应用（后端+前端）必须能被“服务提供者”轻松部署在自己的服务器上。 |
| **技术栈 (约束)** | 1. **后端：** 必须使用 Python **FastAPI** 框架（以匹配 `asyncio` 脚本）。<br> 2. **转录核心：** 必须使用用户提供的 `streaming_whisperx_provider` 脚本。<br> 3. **前端：** 推荐使用 **Vue.js** 或 **Svelte**（用于高效管理数据状态和 DOM）。<br> 4. **播放器：** 推荐使用 [Plyr.io](https://plyr.io/) 或原生 HTML5 `<video>` / `<audio>`。 |

-----

### 4\. 未来规划 (V2.0 / 暂不实现)

  * **高级设置 (V1.1)：** 在一个隐藏的“设置”面板中，允许用户在转录前选择参数（如转录语言、Whisper 模型大小、VAD 阈值）。
  * **用户认证：** 添加登录系统，管理谁有权使用该服务。
  * **项目保存：** 允许用户保存当前的编辑进度，以便下次继续。
  * **高级编辑：** 增加“合并上一句”和“拆分此句”的快捷按钮。
  * **多格式导出：** 支持导出 `.vtt`, `.ass` 等更多字幕格式。